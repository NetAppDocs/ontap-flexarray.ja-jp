---
permalink: install/reference_reasons_for_more_array_lun_groups_than_expected.html 
sidebar: sidebar 
keywords: reasons, array, lun, groups, expected 
summary: 構成を検証する際には、storage array config showの出力をチェックして、LUNグループの数が想定どおりであることを確認する必要があります。余分なアレイLUNグループがある最も一般的な理由は、LDEVが複数のターゲットポートペアにまたがっていることです。 
---
= アレイLUNグループが想定よりも多い理由
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
構成を検証する際には、の出力をチェックして、LUNグループの数が想定どおりであることを確認する必要があり `storage array config show` ます。余分なアレイLUNグループがある最も一般的な理由は、LDEVが複数のターゲットポートペアにまたがっていることです。



== 説明

LUNグループが想定よりも多く表示される一般的な理由は次のとおりです。

* LDEVが冗長ターゲットポートペアにマッピングされていない。
+
余分なLUNグループがある最も一般的な原因は、LDEVが複数のパスペアにまたがっていることです。LDEVの一致するLUN IDがストレージアレイ上の冗長ターゲットポートペアに提供されない場合、LDEVは「_スパニングパスペア_」と呼ばれます。



[NOTE]
====
多くのストレージアレイでは、従来の手順でLDEVを作成してマッピングした場合、冗長でないターゲットポートにLDEVを提供することはできません。

====
* ONTAPは、あるLUNグループから別のグループにアレイLUNを移行する際に、ターゲットポート間で負荷を分散しようとします。
+
この場合、LDEVが複数のパスペアにまたがっているのは一時的な状態です。

* 設定されている接続が多すぎます。


ONTAPは、アレイLUNグループが1つでも複数でも実行できます。そのため、ONTAPではLUNグループがいくつあっても設定ミスとはみなされません。ただし、ONTAPのリリースによっては、すべてのストレージアレイで複数のLUNグループがサポートされるわけではありません。構成を計画する際には、Interoperability Matrixの情報を参照して、ONTAP構成で使用するストレージアレイで複数のアレイLUNグループがサポートされているかどうかを確認する必要があります。



== 問題のシナリオ

LUNグループ0とLUNグループ1の2つの既存のLUNグループがあるとします。LUNグループ0には2つのアレイLUNがあり、LUNグループ1には3つのアレイLUNがあります。管理者は、LUNグループ0にLUN 3を追加するために、新しいLDEV Zを作成しました。管理者は、2つのストレージアレイポートにLDEV ZをLUN 3としてマッピングしました。ただし、次の図に示すように、LUN 3がマッピングされたポート（ストレージアレイポート1Aと2B）は冗長ターゲットポートペアではありません。

image::../media/ldev_spans_path_pairs_v2.gif[この図には説明が付随しています。]

このエラーにより、次の例に示すように、3つ目の意図しないLUNグループ（グループ2）が作成されます。

[listing]
----

mysystem1::> storage array config show

          LUN   LUN
Node      Group Count  Array Name  	Array Target Ports     	Switch Port  	Initiator
-------   ----- ------ ----------- 	-------------------    	-----------  	---------

mysystem1  0     3     DGC_RAID5_1  20:1A:00:a0:b8:0f:ee:04  vnbr20es25:5    0a
                                   	20:2A:00:a0:b8:0f:ee:04  vnci9124s53:6   0c
           1     3     DGC_RAID5_1  20:1B:00:a0:b8:0f:ee:04  vnbr20es25:7    0b
                                   	20:2B:00:a0:b8:0f:ee:04  vnci9124s53:8   0d
           2     1     DGC_RAID5_1  20:1A:00:a0:b8:0f:ee:04  vnbr20es25:5    0a
                                   	20:2B:00:a0:b8:0f:ee:04  vnci9124s53:8   0d
----
グループ0および1の[Array Target Ports]列の情報から、アレイターゲットポートへのパスが冗長であると推測できます。グループ0はターゲットポートペアである1Aと2Aに接続されます。グループ1は別のターゲットポートペアである1Bと2Bに接続されます。

ただし、グループ2の[Array Target Ports]列に表示される情報から、パスが冗長でないことがわかります。一方のパスはターゲットポート1Aに、もう一方のパスはターゲットポート2Bに接続されます。これは冗長ターゲットポートペアではなく、アレイLUNは複数のLUNグループにまたがっています。アレイLUNを1Aと2Aまたは1Bと2Bにマッピングします。

ONTAPシステムはLDEVが複数のパスペアにまたがっていても実行できるため、コマンドの実行後に、を実行するように指示するメッセージは `storage errors show` 表示されません `storage array config show` 。ただし、これはベストプラクティスの構成ではありません。



== 問題の解決

. 1分待ってからをもう一度実行して、 `storage array config show` の出力に余分なLUNグループが引き続き表示されるかどうかを確認します `storage array config show` 。
+
** 余分なLUNグループがの出力に表示されなくなった場合は、問題が一時的なものであったと判断できます。
** 余分なLUNグループが引き続き出力に表示される場合は、ストレージアレイ管理者が次の手順でLDEVを再マッピングする必要があります。
+
この問題を修正する間、冗長性を維持する必要があります。この手順では、誤ったターゲットポートへのマッピングを削除する前に、正しいターゲットポートにLDEVをマッピングするように指示します。パスの数を1つに減らすのではなく、問題の修正中にパスの数を1つに減らすのではなく、一時的に3つに増やすため、冗長性が維持されます。



. 整合性のないターゲットポートのうち、再マッピングするポートを決定します。
. ストレージアレイで、LDEVを新しい（正しい）ターゲットポートにマッピングします。
. ONTAPで、を実行して `storage array config show` パスが3つ表示されることを確認します。
. 誤ったマッピングを削除します。
. ONTAPがLUNを検出するまで1分待ちます。
. ONTAPでを再度実行して、 `storage array config show` 余分なLUNグループがなくなったことを確認します。


* 関連情報 *

https://mysupport.netapp.com/matrix["NetApp Interoperability Matrix Tool"]
